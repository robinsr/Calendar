<!DOCTYPE html>
<html>
    <head>
        <title>CSV to Calendar</title>
        <script src="moment.js"></script>
        <style type="text/css">
        #calendar table {
            border-collapse: collapse;
        }

        #calendar td {
            border: 1px solid black;
            padding:20px 10px 20px 10px;
            vertical-align: top;
        }
        </style>
    </head>
    <body>
        <div id="calendar"></div>
        <button type="button" id="decrementMonthButton">Decrement Month</button>
        <button type="button" id="incrementMonthButton">Increment Month</button>

    <script>
            // gets day of the year ie 1-365
        Date.prototype.getDOY = function() {
            var onejan = new Date(this.getFullYear(),0,1);
            return Math.ceil((this - onejan) / 86400000);
        }


        
        var calendar = (function(){
            var monthNames = [ 
                "January", 
                "February", 
                "March", 
                "April", 
                "May", 
                "June",
                "July", 
                "August", 
                "September", 
                "October", 
                "November", 
                "December" ];

            function getJanFirstDOY(y){
                var d = new Date();
                d.setFullYear(y,0,1);
                return d.getDay();
            }

            var daysInEachMonth;

            function makeDaysInEachMonth(y){
                var d = new Date();
                d.setFullYear(y,11,31);
                var totalsDaysThisYear = d.getDOY();

                if (totalsDaysThisYear == 365){
                    daysInEachMonth = [31,28,31,30,31,30,31,31,30,31,30,31];
                } else {
                    daysInEachMonth = [31,29,31,30,31,30,31,31,30,31,30,31];
                }
            }

            var weeks = [];
            var weeksInEachMonth = [];

            function constructWeeksObject(year){
                makeDaysInEachMonth(year);
                var janFirstDOY = getJanFirstDOY(year);
                var week = [];
                var janDaysInFirstWeek = 7 - janFirstDOY;
                var runoverDaysFromDec = 7 - janDaysInFirstWeek;
                var fistDecDayInFirstWeek = 32 - runoverDaysFromDec;
                var currentDay = 1;
                var currentMonth = 0;
                for (i=fistDecDayInFirstWeek;i<32;i++){
                    week.push(i)
                }
                for (i=1;i<=janDaysInFirstWeek;i++){
                    week.push(i);
                    currentDay = i;
                }
                weeks.push(week);
                var thisMonthsWeeks = [];
                thisMonthsWeeks.push(0);
                for (i=1;i<53;i++){
                    week = [];
                    for (j=0;j<7;j++){
                        if ((currentDay + 1) > daysInEachMonth[currentMonth]){
                            currentDay = 0;
                            currentMonth++;
                            currentDay++;
                            week.push(currentDay);
                            thisMonthsWeeks.push(i);
                            weeksInEachMonth.push(thisMonthsWeeks);
                            thisMonthsWeeks = [];
                        } else {
                            currentDay++;
                            week.push(currentDay);
                        }
                        if (j==6){
                            weeks.push(week);
                            thisMonthsWeeks.push(i);
                        }
                    }
                }
            }

            function displayWeeks(){
                for (f=0;f<weeksInEachMonth.length;f++){
                    document.body.appendChild(document.createTextNode(monthNames[f]+":  "));
                    document.body.appendChild(document.createTextNode(weeksInEachMonth[f]));
                    document.body.appendChild(document.createElement('br'));
                }
                for (f=0;f<weeks.length;f++){
                    document.body.appendChild(document.createTextNode("week number: "+f+":  "));
                    document.body.appendChild(document.createTextNode(weeks[f]));
                    document.body.appendChild(document.createElement('br'));
                }
            }
            
            var tableElement = document.getElementById('calendar');

            var dayName = {
                0:'Sunday',
                1:'Monday',
                2:'Tuesday',
                3:'Wednesday',
                4:'Thursday',
                5:'Friday',
                6:'Saturday'
            }
            makeWeekRow = function(wToCreate){
                console.log('creating week #',wToCreate)
                var tr = document.createElement('tr');
                for (i=0;i<7;i++){
                    var dataAttribute; 
                    var td = document.createElement('td');
                    var className = "Day Day-"+dayName[i];
                    td.setAttribute('class',className);
                    td.appendChild(document.createTextNode(weeks[wToCreate][i]+" "+dayName[i]));
                    tr.appendChild(td);
                }
                return tr;
            }
            return {
                
                loadCalendarView : function(monthToCreate,yearToCreate){
                    document.getElementById('calendar').innerHTML = '';
                    if (!(monthToCreate && yearToCreate) || (typeof monthToCreate != 'number') || (typeof yearToCreate != 'number')){
                        console.log('loadCalendarView requires month(int) and year(int)');
                        return
                    }
                    constructWeeksObject(yearToCreate);  

                    var weeksToCreate = weeksInEachMonth[monthToCreate]

                    console.log(weeksToCreate);

                    var table = document.createElement('table');

                    var caption = document.createElement('caption');
                    caption.appendChild(document.createTextNode(monthNames[monthToCreate]+", some year?"));
                    table.appendChild(caption);
                    
                    for (j=0;j<weeksToCreate.length;j++){
                        console.log('making row');
                        table.appendChild(makeWeekRow(weeksToCreate[j]));
                    }
                    
                    tableElement.appendChild(table);
                }    
        
            }
        })();
        
         window.onload = function(){
            var today = new Date();
            var IWantToSeeMonth = today.getMonth();
            calendar.loadCalendarView(IWantToSeeMonth,2013);

            document.getElementById('decrementMonthButton').addEventListener('click',function(){
                IWantToSeeMonth--;
                calendar.loadCalendarView(IWantToSeeMonth);
            });
            document.getElementById('incrementMonthButton').addEventListener('click',function(){
                IWantToSeeMonth++;
                calendar.loadCalendarView(IWantToSeeMonth);
            });
        }
    </script>
</body>
</html>