<!DOCTYPE html>
<html>
    <head>
        <title>CSV to Calendar</title>
        <script src="moment.js"></script>
    </head>
    <body>
        <div id="calendar"></div>

    <script>
            // gets day of the year ie 1-365
        Date.prototype.getDOY = function() {
            var onejan = new Date(this.getFullYear(),0,1);
            return Math.ceil((this - onejan) / 86400000);
        }

        var monthNames = [ 
                "January", 
                "February", 
                "March", 
                "April", 
                "May", 
                "June",
                "July", 
                "August", 
                "September", 
                "October", 
                "November", 
                "December" ];

        function getJanFirstDOY(){
            var d = new Date();
            d.setMonth(0);
            d.setDate(1);
            return d.getDay();
        }

        var daysInEachMonth;

        function makeDaysInEachMonth(){
            var d = new Date();
            d.setFullYear(d.getFullYear(),11,31);
            var totalsDaysThisYear = d.getDOY();

            if (totalsDaysThisYear == 365){
                daysInEachMonth = [31,28,31,30,31,30,31,31,30,31,30,31];
            } else {
                daysInEachMonth = [31,29,31,30,31,30,31,31,30,31,30,31];
            }
        }
        //console.log(getJanFirstDOY());

        var weeks = [];
        var weeksInEachMonth = [];

        function constructWeeksObject(){



            makeDaysInEachMonth();

            var janFirstDOY = getJanFirstDOY();

            var week = [];

            var janDaysInFirstWeek = 7 - janFirstDOY;

            var runoverDaysFromDec = 7 - janDaysInFirstWeek;

            var fistDecDayInFirstWeek = 32 - runoverDaysFromDec;

            var currentDay = 1;

            var currentMonth = 0;


            for (i=fistDecDayInFirstWeek;i<32;i++){
                week.push(i)
            }

            

            for (i=1;i<=janDaysInFirstWeek;i++){
                week.push(i);
                currentDay = i;
            }

            weeks.push(week);

            

            var thisMonthsWeeks = [];
            
            thisMonthsWeeks.push(0);

            for (i=1;i<53;i++){

                week = [];

                for (j=0;j<7;j++){
                    if ((currentDay + 1) > daysInEachMonth[currentMonth]){
                        
                        currentDay = 0;
                        currentMonth++;

                        currentDay++;
                        week.push(currentDay);

                        thisMonthsWeeks.push(i);
                        weeksInEachMonth.push(thisMonthsWeeks);
                        thisMonthsWeeks = [];
                        console.log('rolling over week');

                    } else {

                        currentDay++;
                        week.push(currentDay);

                    }

                    if (j==6){

                        weeks.push(week);
                        thisMonthsWeeks.push(i);
                        console.log('adding week '+i)

                    }
                }
            }
        }

        function displayWeeks(){
            for (f=0;f<weeksInEachMonth.length;f++){
                document.body.appendChild(document.createTextNode(monthNames[f]+":  "));
                document.body.appendChild(document.createTextNode(weeksInEachMonth[f]));
                document.body.appendChild(document.createElement('br'));
            }
            for (f=0;f<weeks.length;f++){
                document.body.appendChild(document.createTextNode("week number: "+f+":  "));
                document.body.appendChild(document.createTextNode(weeks[f]));
                document.body.appendChild(document.createElement('br'));
            }
            console.log(weeks);
        }
        
        /*var calendar = (function(){
            var date = moment();
            
            var tableElement = document.getElementById('calendar');
            var dayName = {
                0:'Sunday',
                1:'Monday',
                2:'Tuesday',
                3:'Wednesday',
                4:'Thursday',
                5:'Friday',
                6:'Saturday'
            }
            makeWeekRow = function(){
                var tr = document.createElement('tr');
                for (i=0;i<7;i++){
                    var td = document.createElement('td');
                    var className = "Day-"+dayName[i];
                    td.setAttribute('class',className);
                    td.appendChild(document.createTextNode(dayName[i]));
                    tr.appendChild(td);
                }
                return tr;
            }
            return {
                
                loadCalendarView : function(){
                    console.log(date);
                    var table = document.createElement('table');
                    
                    for (j=0;j<6;j++){
                        console.log('making row');
                        table.appendChild(makeWeekRow());
                    }
                    
                    tableElement.appendChild(table);
                }    
        
            }
        })();*/
        
         window.onload = function(){
            constructWeeksObject();  
            displayWeeks(); 
        }
    </script>
</body>
</html>